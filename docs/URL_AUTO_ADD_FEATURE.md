# Автоматическое добавление ссылок

## Описание

Добавлена новая функциональность, которая позволяет автоматически добавлять ссылки в коллекцию пользователя при их отправке в чат.

## Как это работает

### Основная функциональность

1. **Автоматическое обнаружение**: Когда пользователь отправляет сообщение с URL в главном меню, бот автоматически определяет, что это ссылка.

2. **Подтверждение**: Бот предлагает пользователю подтвердить добавление ссылки с извлеченным названием.

3. **Сохранение**: После подтверждения ссылка сохраняется в базу данных с категорией "general" по умолчанию.

### Валидация URL

Функция `is_valid_url()` проверяет корректность URL с помощью регулярного выражения:

- Поддерживает протоколы `http://` и `https://`
- Поддерживает домены, IP-адреса и localhost
- Поддерживает порты
- Поддерживает пути, параметры и фрагменты

### Извлечение названия

Функция `extract_title_from_url()` извлекает название из URL:

- Убирает `www.` префикс
- Убирает порт из домена
- Берет только первую часть домена (до первой точки)
- Делает первую букву заглавной

Примеры:
- `https://www.google.com` → `Google`
- `https://github.com/user/repo` → `Github`
- `http://localhost:3000` → `Localhost`

## Техническая реализация

### Новые функции

1. **`is_valid_url(url: str) -> bool`**
   - Проверяет валидность URL с помощью регулярного выражения
   - Возвращает `True` для корректных URL

2. **`extract_title_from_url(url: str) -> str`**
   - Извлекает название из URL
   - Обрабатывает различные форматы доменов

3. **`handle_url_message(message: Message, state: FSMContext)`**
   - Обработчик сообщений с URL
   - Проверяет состояние пользователя
   - Создает подтверждение для добавления ссылки

### Новые callback-обработчики

1. **`callback_confirm_add_url`**
   - Обрабатывает подтверждение добавления URL
   - Сохраняет ссылку в базу данных

2. **`callback_cancel_add_url`**
   - Обрабатывает отмену добавления URL
   - Очищает состояние

### Обновления в главном меню

- Добавлена информация о новой функциональности в приветственное сообщение
- Обновлена справка с описанием работы со ссылками

## Ограничения

1. **Состояния**: Функция не работает, если пользователь находится в состоянии ожидания ввода (например, при добавлении описания к файлу).

2. **Валидация**: Поддерживаются только HTTP и HTTPS протоколы.

3. **Названия**: Извлечение названия работает только для стандартных доменов.

## Тестирование

Создан тестовый файл `test_url_functionality.py` для проверки:

- Валидации различных типов URL
- Извлечения названий из URL
- Обработки различных паттернов URL

## Использование

### Для пользователей

1. Просто вставьте ссылку в чат
2. Бот предложит добавить её в коллекцию
3. Подтвердите или отмените добавление

### Для разработчиков

```python
# Проверка валидности URL
if is_valid_url(message.text):
    await handle_url_message(message, state)

# Извлечение названия
title = extract_title_from_url(url)
```

## Планы развития

1. **Улучшение извлечения названий**: Использование API для получения реальных названий сайтов
2. **Расширенная валидация**: Поддержка дополнительных протоколов
3. **Категоризация**: Автоматическое определение категории ссылки
4. **Предпросмотр**: Получение превью сайта при добавлении ссылки 